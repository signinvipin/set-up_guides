Set-up Elasticsearch, Kibana, and logstash
------------------------------------------
ref -
https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-with-rpm#rpm-repo
https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-kibana-with-rpm#rpm-running-systemd
https://www.elastic.co/docs/reference/logstash/installing-logstash#_yum

> Elasticsearch 7.17.x is the latest available for Centos8
> OpenJDK-11 is compatible with Elasticsearch 7.17.x
> Kibana 7.17.x is compatible with Elasticsearch 7.17.x
> Logstash 7.17.x compatible with Elasticsearch 7.17.x
> Check for compatibility - https://www.elastic.co/support/matrix#matrix_jvm

Hardware requirements -
4gb ram, 2core cpu, 50gb storage - test purpose
8gb ram, 4core cpu, 50 gb storage - test purpose

## Mirror Cmds Centos ##
sudo su
sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*
sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*
yum install epel-release -y

yum update -y

## Elasticsearch setup

> Install from the RPM repository -
create file 'elasticsearch.repo' in directory '/etc/yum.repos.d/' (for red hat) or '/etc/zypp/repos.d/' for openSUSE with below content

[elasticsearch]
name=Elasticsearch repository for 7.x packages
baseurl=https://artifacts.elastic.co/packages/7.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=0
autorefresh=1
type=rpm-md

> Install elasticsearch using below command - 
For centos and red hat
$ sudo yum install --enablerepo=elasticsearch elasticsearch

For openSuSe ---
$ sudo zypper modifyrepo --enable elasticsearch
$ sudo zypper install elasticsearch
$ sudo zypper modifyrepo --disable elasticsearch

> Install Elasticsearch the RPM manually
$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-9.0.3-x86_64.rpm
$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-9.0.3-x86_64.rpm.sha512
$ shasum -a 512 -c elasticsearch-9.0.3-x86_64.rpm.sha512
$ sudo rpm --install elasticsearch-9.0.3-x86_64.rpm

> Set up the node for connectivity and Set up a node as the first node in a cluster - 
Edit 'elasticsearch.yaml' present at (maybe here) '/etc/elasticsearch/elasticsearch.yml'
$ cd /etc/elasticsearch
$ vi elasticsearch.yaml/yml

change/set values of keys as below and save changes
network.host: 0.0.0.0 or network.host: localhost
path.data: /elk/elasticsearch/data

#Copy the terminal output from the install command to a local file. In particular, youâ€™ll need the password for #the built-in elastic superuser account. The output also contains the commands to enable Elasticsearch to run #as a service (https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-with-#rpm#running-systemd).

> Start Elasticsearch automatically
$ sudo /bin/systemctl daemon-reload
$ sudo /bin/systemctl enable elasticsearch.service

> Run Elasticsearch with systemd
$ sudo systemctl start elasticsearch.service
$ sudo systemctl stop elasticsearch.service
$ sudo systemctl restart elasticsearch




visit - https://localhost:9200


## kibana setup

Install Kibana with RPM

> Add repository to centos and import key
$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
$ rpm https://artifacts.elastic.co/packages/7.17.x/yum
(Example: rpm http://packages.elastic.co/kibana/6.1/apt stable main)


> Install kibana and update cache
$ yum update -y (if needed)
$ sudo yum install kibana

> Set up the node for connectivity/accessability
Edit 'kibana.yml' present at (maybe here) '/etc/kibana/kibana.yml'
$ cd /etc/elasticsearch
$ vi kibana.yml

change/set values of keys as below and save changes
server.host: localhost (we use this now)
server.host: 0.0.0.0 (for open accesses from anywhere)

> Enable Kibana with systemd
$ sudo /bin/systemctl daemon-reload
$ sudo /bin/systemctl enable kibana.service

> Start/Stop kibana 
$ sudo systemctl start kibana.service
$ sudo systemctl stop kibana.service

> Check status kibana
$ sudo systemctl status kibana

visit - http://<host>:5601/

## Logstash

Installing from Package Repositories

> Import the public key
$ sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch

> Add repository
$ https://artifacts.elastic.co/packages/9.x/yum stable main

> Update cache
$ yum update -y

> Install logstash
$ sudo yum install logstash

> Running Logstash by Using Systemd / start up Logstash
$ sudo systemctl start logstash.service